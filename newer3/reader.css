/* =========================================================
   dukr3g reader.css  —  consolidated, namespaced, theme-aware
   ========================================================= */

/* -----------------------------
   Base tokens
   ----------------------------- */
:root{
  /* Reading typography applied to .dukr3g-prose only */
  --dukr3g-scale:   1.00;
  --dukr3g-measure: 70;
  --dukr3g-leading: 1.60;
  --dukr3g-font: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Sans", sans-serif;

  /* Toolbar tokens with safe defaults */
  --dukr3g-surface:   #ffffff;
  --dukr3g-surface-2: #f4f6f8;
  --dukr3g-text:      #111111;
  --dukr3g-border:    #d7dde3;
  --dukr3g-accent:    #2b6cf0;
  --dukr3g-shadow:    0 8px 28px rgba(0,0,0,.20);
  --dukr3g-backdrop:  rgba(0,0,0,.40);

  /* Opener glyph metrics */
  --dukr3g-open-size: 20px;
  --dukr3g-open-nudge-x: 0px;
  --dukr3g-open-nudge-y: -1px;
  --dukr3g-fab-bg:    rgba(0,0,0,.55);
  --dukr3g-fab-fg:    #ffffff;

  /* Status pill */
  --dukr3g-status-bg: rgba(0,0,0,.60);
  --dukr3g-status-fg: #ffffff;
}

/* -----------------------------
   Document theme classes on <html>
   ----------------------------- */
.dukr3g-theme-light { color:#111; background:#fff; }
.dukr3g-theme-dark  { color:#eee; background:#111; }
.dukr3g-theme-sepia { color:#2b1d13; background:#f4ecd8; }
.dukr3g-theme-gray  { color:#111; background:#f2f2f2; }
.dukr3g-theme-high-contrast { color:#000; background:#fff; }
.dukr3g-theme-high-contrast a{ outline:2px solid currentColor; }

/* Per-theme overrides for toolbar tokens */
.dukr3g-theme-light{
  --dukr3g-surface:#ffffff; --dukr3g-surface-2:#f3f3f5; --dukr3g-text:#111111;
  --dukr3g-border:#d7dde3; --dukr3g-accent:#2b6cf0; --dukr3g-shadow:0 8px 28px rgba(0,0,0,.20);
  --dukr3g-backdrop:rgba(0,0,0,.40); --dukr3g-fab-bg:rgba(0,0,0,.55);
  --dukr3g-fab-fg:#ffffff; --dukr3g-status-bg:rgba(0,0,0,.65); --dukr3g-status-fg:#ffffff;
}
.dukr3g-theme-dark{
  --dukr3g-surface:#181a1f; --dukr3g-surface-2:#1f2228; --dukr3g-text:#eaecef;
  --dukr3g-border:#2b3036; --dukr3g-accent:#7fb2ff; --dukr3g-shadow:0 10px 30px rgba(0,0,0,.55);
  --dukr3g-backdrop:rgba(0,0,0,.55); --dukr3g-fab-bg:rgba(255,255,255,.22);
  --dukr3g-fab-fg:#ffffff; --dukr3g-status-bg:rgba(30,30,34,.85); --dukr3g-status-fg:#eaecef;
}
.dukr3g-theme-sepia{
  --dukr3g-surface:#fbf3e3; --dukr3g-surface-2:#efe6cf; --dukr3g-text:#2b1d13;
  --dukr3g-border:#dacfae; --dukr3g-accent:#8a5a20; --dukr3g-shadow:0 8px 26px rgba(60,40,20,.28);
  --dukr3g-backdrop:rgba(40,28,18,.45); --dukr3g-fab-bg:rgba(60,40,20,.55);
  --dukr3g-fab-fg:#fff8ee; --dukr3g-status-bg:rgba(60,40,20,.60); --dukr3g-status-fg:#fff8ee;
}
.dukr3g-theme-gray{
  --dukr3g-surface:#ffffff; --dukr3g-surface-2:#f1f1f1; --dukr3g-text:#111111;
  --dukr3g-border:#d0d0d0; --dukr3g-accent:#3b3b3b; --dukr3g-shadow:0 8px 28px rgba(0,0,0,.18);
  --dukr3g-backdrop:rgba(0,0,0,.35); --dukr3g-fab-bg:rgba(0,0,0,.55);
  --dukr3g-fab-fg:#ffffff; --dukr3g-status-bg:rgba(0,0,0,.55); --dukr3g-status-fg:#ffffff;
}
.dukr3g-theme-high-contrast{
  --dukr3g-surface:#ffffff; --dukr3g-surface-2:#ffffff; --dukr3g-text:#000000;
  --dukr3g-border:#000000; --dukr3g-accent:#000000; --dukr3g-shadow:none;
  --dukr3g-backdrop:rgba(0,0,0,.70); --dukr3g-fab-bg:#000000; --dukr3g-fab-fg:#ffffff;
  --dukr3g-status-bg:#000000; --dukr3g-status-fg:#ffffff;
}

/* -----------------------------
   Reading content
   ----------------------------- */
.dukr3g-prose{
  font-family: var(--dukr3g-font);
  font-size: calc(16px * var(--dukr3g-scale));
  line-height: var(--dukr3g-leading);
  max-width: calc(var(--dukr3g-measure) * 1ch);
  margin: 2rem auto;
  padding: 0 1rem;
}

/* -----------------------------
   Opener button (uses 讀 glyph)
   ----------------------------- */
.dukr3g-open{
  position: fixed; top: 1rem; right: 1rem;
  width: 44px; height: 44px; z-index: 1000;
  border: 1px solid var(--dukr3g-border);
  border-radius: 10px;
  background: var(--dukr3g-fab-bg); color: var(--dukr3g-fab-fg);
  display: inline-flex; align-items: center; justify-content: center;
  cursor: pointer; padding: 0; min-height: 44px;
}
.dukr3g-open:focus-visible{ outline: 2px solid var(--dukr3g-accent); outline-offset: 2px; }

.dukr3g-glyph{
  display: inline-block;
  font: 700 var(--dukr3g-open-size)/1 "Noto Sans CJK SC","Noto Sans CJK TC",
        "PingFang SC","PingFang TC","Microsoft YaHei UI","Microsoft YaHei",
        "Heiti TC","Hiragino Sans GB","Source Han Sans", system-ui, ui-sans-serif;
  transform: translate(var(--dukr3g-open-nudge-x), var(--dukr3g-open-nudge-y));
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
}

/* -----------------------------
   Dialog shell
   ----------------------------- */
#dukr3g-dialog{
  box-sizing: border-box;
  border: 1px solid var(--dukr3g-border);
  color: var(--dukr3g-text);
  background: var(--dukr3g-surface);
  border-radius: 12px; padding: 0;
  width: min(92vw, 760px);
  max-width: 100vw;
  max-height: min(92vh, 720px);
  box-shadow: var(--dukr3g-shadow);
}
#dukr3g-dialog::backdrop{ background: var(--dukr3g-backdrop); }

/* Header, sticky for hierarchy */
.dukr3g-panel-head{
  position: sticky; top: 0; z-index: 1;
  display: grid; grid-template-columns: 1fr auto; align-items: center;
  gap: .75rem; padding: .75rem 1rem;
  border-bottom: 1px solid var(--dukr3g-border);
  background: var(--dukr3g-surface);
}
/* Prefer subtle tint if color-mix is available */
@supports (background: color-mix(in srgb, black 10%, white 90%)){
  .dukr3g-panel-head{
    background: color-mix(in srgb, var(--dukr3g-surface) 86%, var(--dukr3g-text) 14%);
  }
}

/* Header actions */
.dukr3g-head-actions{ display: inline-flex; gap: .5rem; }
.dukr3g-head-actions button{
  min-height: 44px;
  color: inherit; background: transparent;
  border: 1px solid var(--dukr3g-border); border-radius: 8px;
  padding: .5rem .75rem;
}
.dukr3g-head-actions button:focus-visible{
  outline: 2px solid var(--dukr3g-accent); outline-offset: 2px;
}

/* Body scroll container */
.dukr3g-panel-body{
  padding: 1rem;
  display: grid; gap: 1rem;
  overflow: auto;
  overscroll-behavior: contain;
}

/* -----------------------------
   Views and navigation
   ----------------------------- */
.dukr3g-view-heading{ margin: 0 0 .25rem 0; font-size: 1.1rem; }
.dukr3g-view{ display: none; }
.dukr3g-current{ display: grid; }
#dukr3g-btn-back[hidden]{ display: none !important; }

/* -----------------------------
   Tile menu
   ----------------------------- */
.dukr3g-tile-grid{
  --min: 220px;
  display: grid; grid-template-columns: repeat(auto-fit, minmax(var(--min), 1fr));
  gap: 12px; list-style: none; margin: 0; padding: 0;
}
.dukr3g-tile{
  display: grid; align-content: start; gap: 6px;
  min-height: 112px; /* meets tap target comfortably */
  border-radius: 12px; padding: 1rem;
  color: inherit; cursor: pointer; text-align: left;
  background: var(--dukr3g-surface-2);
  border: 1px solid var(--dukr3g-border);
}
.dukr3g-tile:focus-visible{ outline: 2px solid var(--dukr3g-accent); outline-offset: 2px; }
.dukr3g-tile-title{ font: 600 1.1rem/1 ui-sans-serif, system-ui; }
.dukr3g-tile-desc{ opacity: .80; font-size: .95rem; }

/* -----------------------------
   Fieldsets and controls
   ----------------------------- */
fieldset{
  border: 1px solid var(--dukr3g-border);
  border-radius: 8px;
  padding: .85rem;
  background: var(--dukr3g-surface);
  min-inline-size: 0; /* avoid overflow with long labels */
}
legend{ padding: 0 .25rem; font-weight: 600; }

/* Control row: Label | Number | Range | Output, responsive */
.dukr3g-control{
  display: grid;
  grid-template-columns: auto minmax(7ch, 10ch) 1fr auto;
  align-items: center;
  column-gap: .75rem;
  row-gap: .35rem;
}
.dukr3g-control > label{
  font-weight: 600;
  line-height: 1.2;
  white-space: nowrap;
}
.dukr3g-control input[type="number"]{
  padding: .45rem .5rem;
  border: 1px solid var(--dukr3g-border);
  border-radius: 6px;
  background: var(--dukr3g-surface);
  color: var(--dukr3g-text);
  font: 0.95rem/1.2 ui-sans-serif, system-ui;
  width: 100%;
  min-height: 44px;
}
.dukr3g-control input[type="number"]:focus-visible{
  outline: 2px solid var(--dukr3g-accent);
  outline-offset: 2px;
}
.dukr3g-control input[type="range"]{
  width: 100%;
  min-height: calc(44px - 10px);
}
.dukr3g-control output{
  min-width: 5ch;
  text-align: right;
  font-variant-numeric: tabular-nums;
}

/* Stack controls on small screens */
@media (max-width: 520px){
  .dukr3g-control{ grid-template-columns: 1fr; }
  .dukr3g-control > label{ margin-bottom: .15rem; }
  .dukr3g-control output{ justify-self: end; }
}
@media (max-width: 380px){
  .dukr3g-control input[type="number"]{ min-width: 12ch; }
  .dukr3g-control input[type="range"]{ margin-block: .15rem; }
}

/* -----------------------------
   TTS transport buttons
   ----------------------------- */
.dukr3g-tts-playback button{
  min-width: 44px; min-height: 44px;
  padding: .5rem .75rem;
  border: 1px solid var(--dukr3g-border);
  border-radius: 8px;
  background: var(--dukr3g-surface-2);
  color: var(--dukr3g-text);
}

/* -----------------------------
   Live status pill
   ----------------------------- */
.dukr3g-status{
  position: fixed; bottom: .5rem; left: 50%; transform: translateX(-50%);
  padding: .25rem .5rem; border-radius: 6px;
  background: var(--dukr3g-status-bg); color: var(--dukr3g-status-fg);
  font: 0.95rem/1.2 ui-sans-serif, system-ui; pointer-events: none;
}

/* -----------------------------
   High contrast adaptations
   ----------------------------- */
.dukr3g-theme-high-contrast .dukr3g-tile-grid{ grid-template-columns: 1fr; }
.dukr3g-theme-high-contrast .dukr3g-tile-desc{ opacity: 1; }
.dukr3g-theme-high-contrast .dukr3g-panel-head{ background: #fff; }

/* -----------------------------
   Forced colors compliance
   ----------------------------- */
@media (forced-colors: active){
  #dukr3g-dialog, .dukr3g-tile, fieldset, .dukr3g-open,
  .dukr3g-control input[type="number"], .dukr3g-control input[type="range"],
  .dukr3g-head-actions button, .dukr3g-tts-playback button{
    forced-color-adjust: none;
    background: Canvas;
    color: CanvasText;
    border: 1px solid CanvasText;
  }
  #dukr3g-dialog::backdrop{ background: rgba(0,0,0,.7); }
  .dukr3g-open{ background: ButtonFace; color: ButtonText; }
  .dukr3g-status{ background: CanvasText; color: Canvas; }
}

/* -----------------------------
   Reduced motion
   ----------------------------- */
@media (prefers-reduced-motion: reduce){
  *{ transition-duration: 0.001ms !important; animation-duration: 0.001ms !important; }
}
